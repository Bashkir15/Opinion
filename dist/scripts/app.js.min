!function(){"use strict";angular.module("opinionated.utilities",["ui.router","ngResource","ngMessages","ngAria","ngAnimate","ngMaterial","ngFileUpload"])}(),function(){"use strict";function e(){function e(e,t){e.setFocus&&t[0].focus()}var t={scope:{setFocus:"="},link:e};return t}angular.module("opinionated.utilities").directive("setFocus",e)}(),function(){"use strict";angular.module("opinionated.moment",[]).constant("opinionatedMomentConfig",{preprocess:null,timezone:null,format:null,statefulFilters:!0}).constant("moment",moment)}(),function(){"use strict";function e(e,t,n,o){function r(n,o){var r=e.locale(n,o);return angular.isDefined(n)&&t.$broadcast("opMoment:localeChanged"),r}function a(n){e.tz&&e.tz.setDefault&&(e.tz.setDefault(n),t.$broadcast("opMoment:timezoneChanged")),o.timezone=n,i=n}function s(t){return i!==o.timezone&&this.changeTimezone(o.timezone),o.preprocess?o.preprocess(t):e(!isNaN(parseFloat(t))&&isFinite(t)?parseInt(t,10):t)}var i=null,l={changeLocale:r,changeTimezone:a,preprocessDate:s};return l}e.$inject=["moment","$rootScope","$log","opinionatedMomentConfig"],angular.module("opinionated.moment").factory("opMoment",e)}(),function(){"use strict";function e(e,t,n){function o(e,n,o){var r=t.preprocessDate(e);return r.isValid()?r.calendar(n,o):""}return o.$stateful=n.statefulFilters,o}e.$inject=["moment","opMoment","opinionatedMomentConfig"],angular.module("opinionated.moment").filter("opCalendar",e)}(),function(){"use strict";function e(){function e(e,t,n,o){o.$validators.passwordCheck=function(t){return t==e.otherModelValue},e.$watch("otherModelValue",function(){o.$validate()})}var t={require:"ngModel",link:e,scope:{otherModelValue:"=passwordCheck"}};return t}angular.module("opinionated.utilities").directive("passwordCheck",e)}(),function(){"use strict";angular.module("opinionated.admin",[])}(),function(){"use strict";function e(e,t,n,o,r){function a(e){if(e)var t=o.single.get({threadId:l},function(){t.title=i.thread.title,t.content=i.thread.content,t.$modify({threadId:l},function(e){e.success?(r.success("You just edited your thread: "+e.res.record.title),window.history.go(-1)):r.error(e.res.message)})});else r.error("Hmm, something seems to be missing...")}function s(){var e=o.single.get({threadId:l},function(){i.thread=e.res.record,i.thread.title=i.thread.title,i.thread.content=i.thread.content})}var i=this,l=t.threadId;i.edit=a,i.getThread=s,s()}e.$inject=["$state","$stateParams","$location","appThreads","appToast"],angular.module("opinionated.admin").controller("ThreadEditController",e)}(),function(){"use strict";function e(e,t,n,o,r,a,s,i,l,c,d){function m(){var e=i.single.get({streamId:b},function(){T.stream=[e.res.record],T.moderators=e.res.moderators,T.isMod=e.res.isMod})}function u(e){e=e||{};var t=l.list.get({streamId:b,page:T.feedPage,timestamp:T.lastUpdated,filter:T.feedsFilter},function(){T.feedsFilter&&(T.feed=[]),e.append?T.feed=T.feed.concat(t.res.records):T.feed=t.res.records.concat(T.feed),T.noMoreThreads=!t.res.morePages,T.lastUpdated=Date.now()})}function p(e,t){e&&c.upload({url:"/streams/"+b+"/imageUpload",file:e}).progress(function(e){T.progressPercentage=parseInt(100*e.loaded/e.total)}).success(function(e,t,n,o){T.getStream({reload:!0})})}function f(){r.url("streams/"+b+"/edit")}function g(){o.show({controller:["$scope","$mdDialog",function(e,n){e.close=function(){n.hide()},e.confirm=function(){var e=i.single.get({streamId:b},function(){e.$destroy({streamId:b},function(e){e.success&&(d("You have just deleted a stream"),n.hide(),t.go("home"))})})}}],templateUrl:"/app/admin/streams/dialogs/delete.stream.dialog.tmpl.html"})["finally"](function(){T.updateFeed({reload:!0})})}function h(e){var t=l.single.get({threadId:e._id},function(){t.$upvote({threadId:e._id},function(){angular.extend(e,t.res.record)})})}function v(e){var t=l.single.get({threadId:e._id},function(){t.$downvote({threadId:e._id},function(){angular.extend(e,t.res.record)})})}function $(e){var t=l.single.get({threadId:e._id},function(){t.$doSave({threadId:e._id},function(){angular.extend(e,t.res.record)})})}function I(e){var t=l.single.get({threadId:e._id},function(){t.$doUnsave({threadId:e._id},function(){angular.extend(e,t.res.record)})})}function w(){o.show({controller:["$scope","$mdDialog",function(e,n){e.close=function(){n.hide()},e.reset=function(){e.addPostForm.$setUntouched(),e.addPostForm.$setPristine(),e.title=e.content=""},e.create=function(o){if(o){var r=new l.single({title:e.title,content:e.content,stream:b});r.$save(function(o){o.success?(e.reset(),n.hide(),t.reload(),d.success("You just created a thread called: "+o.res.record.title)):d.error(o.res.message)})}else d.error("Hmm, something seems to be missing...")}}],templateUrl:"/app/admin/threads/dialogs/threads.create.dialog.tmpl.html"})["finally"](function(){})}function F(){"-score"==T.rowFilter?T.rowFilter="score":T.rowFilter="-score"}function U(){"created"==T.rowFilter?T.rowFilter="-created":T.rowFilter="created"}function P(){"-saves.length"==T.rowFilter?T.rowFilter="saves.length":T.rowFilter="-saves.length"}function S(){"-comments.length"==T.rowFilter?T.rowFilter="comments.length":T.rowFilter="-comments.length"}function C(){T.feedPage++,T.lastUpdated=0,T.updateFeed({append:!0})}var T=this,b=n.streamId;T.stream=[],T.feed=[],T.getStream=m,T.updateFeed=u,T.addStreamImage=p,T.editStream=f,T.openDeleteStream=g,T.upvote=h,T.downvote=v,T.save=$,T.unsave=I,T.openAddPost=w,T.orderByScore=F,T.orderByDate=U,T.orderBySaves=P,T.orderByReplies=S,T.feedPage=0,T.lastUpdated=0,T.feedsFilter="",T.loadMore=C;var y;e.$watch("vm.feedsFilter",function(e,t){!e!==t&&(T.feed=[]),a.cancel(y),y=a(function(){e?T.updateFeed():T.feedsFilterEnabled&&(T.lastUpdated=0,T.updateFeed()),T.feedsFilterEnabled=""!==T.feedsFilter},500)}),e.$watch(function(){return e.file},function(){T.addStreamImage(e.file)}),m(),u()}e.$inject=["$scope","$state","$stateParams","$mdDialog","$location","$timeout","appAuth","appStreams","appThreads","Upload","appToast"],angular.module("opinionated.admin").controller("StreamsSingleController",e)}(),function(){"use strict";function e(e,t,n,o,r){function a(e){e=e||{};var t=r.list.get({page:u.streamPage,timestamp:u.lastUpdated,filter:u.streamsFilter},function(){u.streamsFilter&&(u.streams=[]),e.append?u.streams=u.streams.concat(t.res.records):u.streams=t.res.records.concat(u.streams),u.noMoreStreams=!t.res.morePages,u.lastUpdated=Date.now()})}function s(e){var t=r.single.get({streamId:e._id},function(){t.$subscribe({streamId:e._id},function(){angular.extend(e,t.res.record)})})}function i(e){var t=r.single.get({streamId:e._id},function(){t.$unsubscribe({streamId:e._id},function(){angular.extend(e,t.res.record)})})}function l(){u.streamPage++,u.lastUpdated=0,u.getStreams({append:!0})}function c(){"-threads.length"==u.rowFilter?u.rowFilter="threads.length":u.rowFilter="-threads.length"}function d(){"subscribers.length"==u.rowFilter?u.rowFilter="-subscribers.length":u.rowFilter="subscribers.length"}function m(){"created"==u.rowFilter?u.rowFilter="-created":u.rowFilter="created"}var u=this;u.streams=[],u.getStreams=a,u.subscribe=s,u.unsubscribe=i,u.loadMore=l,u.streamPage=0,u.lastUpdated=0,u.streamsFilter="",u.orderByThreads=c,u.orderBySubscribers=d,u.orderByDate=m;var p;t.$watch("vm.streamsFilter",function(e,t){!e!==t&&(u.streams=[]),n.cancel(p),p=n(function(){e?u.getStreams():u.streamsFilterEnabled&&(u.lastUpdated=0,u.getStreams()),u.streamsFilterEnabled=""!==u.streamsFilter},500)}),a()}e.$inject=["$state","$scope","$timeout","$location","appStreams"],angular.module("opinionated.admin").controller("StreamsListController",e)}(),function(){"use strict";function e(e,t,n,o){function r(){i.editStreamForm.$setUntouched(),i.editStreamForm.$setPristine(),i.stream.name=i.stream.description=""}function a(e){if(e)var t=o.single.get({streamId:l},function(){t.name=i.stream.name,t.description=i.stream.description,t.$modify({streamId:l},function(e){e.success?(r(),appToast("You have updated the stream "+e.res.record.name),window.history.go(-1)):appToast(e.res.message)})});else appToast("Hmm... Something seems to be missing")}function s(){var e=o.single.get({streamId:l},function(){i.stream=e.res.record,i.stream.name=i.stream.name,i.stream.description=i.stream.description})}var i=this,l=t.streamId;i.reset=r,i.edit=a,i.getStream=s,s()}e.$inject=["$state","$stateParams","appAuth","appStreams"],angular.module("opinionated.admin").controller("StreamsEditController",e)}(),function(){"use strict";function e(e,t,n,o){function r(){s.createStreamForm.$setUntouched(),s.createStreamForm.$setPristine(),s.stream.name=s.stream.description=""}function a(e){if(e){var a=new n.single({name:s.stream.name,description:s.stream.description});a.$save(function(e){e.success?(r(),t.url("streams/"+e.res.record._id),o.success("You just created a stream called: "+e.res.record.name)):o.error(e.res.message)})}else o.error("Hmm, something seems to be missing...")}var s=this;s.reset=r,s.create=a,s.stream={name:"",description:""}}e.$inject=["$rootScope","$location","appStreams","appToast"],angular.module("opinionated.admin").controller("StreamsCreateController",e)}(),function(){"use strict";function e(e,t,n,o,r){function a(e){e=e||{};var t=r.timeline.get({userId:l,timestamp:i.lastUpdated,page:i.timelinePage,filter:i.timelineFilter},function(){i.timelineFilter&&(i.timeline=[]),e.append?i.timeline=i.timeline.concat(t.res.records):i.timeline=t.res.records.concat(i.timeline),i.lastUpdated=Date.now(),i.noMoreThreads=!t.res.morePages})}function s(){i.timelinePage++,i.lastUpdated=0,i.getTimeline({append:!0})}var i=this;i.stateName=t.current.name;var l=n.userId;i.timeline=[],i.getTimeline=a,i.loadMore=s,i.lastUpdated=0,i.timelinePage=0,i.timelineFilter="";var c;e.$watch("vm.timelineFilter",function(e,t){!e!==t&&(i.timeline=[]),o.cancel(c),c=o(function(){e?i.getTimeline():i.timelineFilterEnabled&&(i.lastUpdated=0,i.getTimeline()),i.timelineFilterEnabled=""!==i.timelineFilter},500)}),a()}e.$inject=["$scope","$state","$stateParams","$timeout","appThreads"],angular.module("opinionated.admin").controller("ProfileThreadsController",e)}(),function(){"use strict";function e(e,t,n,o,r,a,s){function i(e){e=e||{};var t=a.saved.get({userId:u,page:m.threadPage,timestamp:m.lastThreadUpdate,filter:m.threadsFilter},function(){m.threadsFilter&&(m.threads=[]),e.append?m.threads=m.threads.concat(t.res.records):m.threads=t.res.records.concat(m.threads),m.lastThreadUpdate=Date.now(),m.noMoreThreads=!t.res.morePages})}function l(e){e=e||{};var t=s.saved.get({userId:u,page:m.commentPage,timestamp:m.lastCommentUpdate,filter:m.commentsFilter},function(){m.commentsFilter&&(m.comments=[]),e.append?m.comments=m.comments.concat(t.res.records):m.comments=t.res.records.concat(m.comments),m.lastCommentUpdate=Date.now(),m.noMoreComments=!t.res.morePages})}function c(){m.threadPage++,m.lastThreadUpdate=0,m.getThreads({append:!0})}function d(){m.commentPage++,m.lastCommentUpdate=0,m.getComments({append:!0})}var m=this,u=t.userId;m.threads=[],m.comments=[],m.threadPage=0,m.commentPage=0,m.lastThreadUpdate=0,m.lastCommentUpdate=0,m.threadsFilter="",m.commentsFilter="",m.getThreads=i,m.getComments=l,m.loadMoreThreads=c,m.loadMoreComments=d;var p,f;n.$watch("vm.threadsFilter",function(e,t){!e!==t&&(m.threads=[]),o.cancel(p),p=o(function(){e?m.getThreads():m.threadsFilterEnabled&&(m.lastThreadUpdate=0,m.getThreads()),m.threadsFilterEnabled=""!==m.threadsFilter},500)}),n.$watch("vm.commentsFilter",function(e,t){!e!==t&&(m.comments=[]),o.cancel(f),f=o(function(){e?m.getComments():m.commentsFilterEnabled&&(m.lastCommentUpdate=0,m.getComments()),m.commentsFilterEnabled=""!==m.commentsFilter},500)}),i(),l()}e.$inject=["$state","$stateParams","$scope","$timeout","appAuth","appThreads","appComments"],angular.module("opinionated.admin").controller("ProfileSavedController",e)}(),function(){"use strict";function e(e,t,n,o,r,a){function s(){n.show({controller:["$scope","$mdDialog",function(e,t){e.search="",e.doSearch=function(e){return a(e).then(function(e){return e.res.items})},e.goToUser=function(e){o.url("profile/"+e._id+"/overview"),t.hide()},e.clearSearch=function(){e.search=""},e.close=function(){t.hide()}}],templateUrl:"/app/admin/profile/dialogs/users.search.dialog.tmpl.html"})["finally"](function(){})}var i=this;i.stateName=t.current.name,i.openUserSearch=s}e.$inject=["$scope","$state","$mdDialog","$location","appAuth","appUsersSearch"],angular.module("opinionated.admin").controller("ProfileOverviewController",e)}(),function(){"use strict";function e(e,t,n,o,r,a){function s(e){e=e||{};var t=a.timeline.get({userId:c,timestamp:l.lastUpdated,page:l.timelinePage,filter:l.timelineFilter},function(){l.timelineFilter&&(l.timeline=[]),e.append?l.timeline=l.timeline.concat(t.res.records):l.timeline=t.res.records.concat(l.timeline),l.lastUpdated=Date.now(),l.noMoreComments=!t.res.morePages})}function i(){l.timelinePage++,l.lastUpdated=0,l.getTimeline({append:!0})}var l=this;l.stateName=e.current.name;var c=t.userId;l.timeline=[],l.getTimeline=s,l.loadMore=i,l.lastUpdated=0,l.timelinePage=0,l.timelineFilter="";var d;n.$watch("vm.timelineFilter",function(e,t){!e!==t&&(l.timeline=[]),o.cancel(d),d=o(function(){e?l.getTimeline():l.timelineFilterEnabled&&(l.lastUpdated=0,l.getTimeline()),l.timelineFilterEnabled=""!==l.timelineFilter},500)}),s()}e.$inject=["$state","$stateParams","$scope","$timeout","appUsers","appComments"],angular.module("opinionated.admin").controller("ProfileCommentsController",e)}(),function(){"use strict";function e(e,t,n,o,r,a,s){function i(e){if(e)var t=a.single.get({commentId:d},function(){t.content=c.comment.content,t.$modify({commentId:d},function(e){e.success?(s.success("You just edited your comment!"),window.history.go(-1)):s.error(e.res.message)})});else s.error("Hmm, something seems to be missing")}function l(){var e=a.single.get({commentId:d},function(){c.comment=e.res.record,c.comment.content=e.res.record.content})}var c=this,d=(t.threadId,t.commentId);c.edit=i,c.getComment=l,l()}e.$inject=["$state","$stateParams","$scope","$location","appThreads","appComments","appToast"],angular.module("opinionated.admin").controller("EditCommentController",e)}(),function(){"use strict";function e(e,t,n,o,r,a,s,i,l){function c(){var e=l.single.get({chatId:p},function(){u.chat=[e.res.record],u.messages=e.res.record.messages,d()})}function d(){r(function(){var e=document.getElementById("scrollContainer");e.scrollTop=e.scrollHeight},0,!1)}function m(e){if(e){var t=u.obj.message;u.obj.message="",l.single.message({message:t,creator:s.getUser()._id,_id:p},function(e){u.messages.push(e.res.record.messages[0]),d()})}}var u=this,p=o.chatId;u.getChat=c,u.sendMessage=m,u.scrollToBottom=d,u.user=s.getUser(),u.chat=[],u.obj={message:""},c()}e.$inject=["$scope","$rootScope","$state","$stateParams","$timeout","$mdDialog","appAuth","appToast","appChats"],angular.module("opinionated.admin").controller("ChatsSingleController",e)}(),function(){"use strict";function e(e,t,n,o,r,a,s,i){function l(){var e=0;m.chats.forEach(function(t){e+=t.unread})}function c(e,t,n){var o;n?(n.unread=0,l(),o={chatId:n._id}):o={participants:[t._id,a.getUser()._id]};var s=new i.single(o);s.$save(function(t){var n=t.res.record._id;u[t.res.record._id]=t.res.record,r.show({controller:["$scope","$mdDialog",function(e,o){l(),e.messages=t.res.record.messages,e.chatId=n,e.firstTime=!0,e.$on("chatMessage",function(t,n){e.$apply(function(){e.messages.unshift(n.chatMessage)})}),e.close=function(){o.hide()},e.sendMessage=function(t){if(t){var n=e.message;e.message="",i.single.message({message:n,creator:a.getUser()._id,_id:e.chatId},function(t){e.messages.unshift(t.res.record.messages[0])})}}}],templateUrl:"/app/admin/chats/dialogs/chat.dialog.tmpl.html",targetEvent:e})["finally"](function(){delete u[n]})})}function d(e){e=e||{};var t=i.single.get({},function(){e.reload&&(m.chats=[]),t.res.records.length&&(e.append?m.chats=m.chats.concat(t.res.records):m.chats=t.res.records.concat(m.chats)),l(),m.noMoreChats=!t.res.morePages,m.lastUpdated=Date.now()})}var m=this,u={};m.chats=[],m.actions={},m.updateBadges=l,m.message=c,m.updateChats=d,m.user=a.getUser(),e.$on("chatMessage",function(e,t){u[t.chatId]||m.updateChats({reload:!0})}),d()}e.$inject=["$scope","$rootScope","$state","$timeout","$mdDialog","appAuth","appToast","appChats"],angular.module("opinionated.admin").controller("ChatsInboxController",e)}(),function(){"use strict";function e(e){function t(t){var n=e.simple().content(t).action("OK").highlightAction(!1).position("top right").theme("success-toast");e.show(n)}function n(t){var n=e.simple().content(t).action("OK").highlightAction(!1).position("top right").theme("error-toast");e.show(n)}var o={success:t,error:n};return o}e.$inject=["$mdToast"],angular.module("opinionated.utilities").factory("appToast",e)}(),function(){"use strict";function e(){function e(e){return localStorage.getItem(e)}function t(e,t){return localStorage.setItem(e,t)}function n(e){return localStorage.removeItem(e)}var o={get:e,set:t,remove:n};return o}angular.module("opinionated.utilities").factory("appStorage",e)}(),function(){"use strict";function e(e){return{request:function(t){return t.headers.Authorization="Bearer "+e.get("opinion-token"),t}}}e.$inject=["appStorage"],angular.module("opinionated.utilities").factory("tokenHttpInterceptor",e)}(),function(){"use strict";function e(e,t){function n(){var e=t.get("user");return e?angular.fromJson(e):void 0}function o(){return t.get("opinion-token")}function r(){return t.get("opinion-token")}function a(){e.get("users/me").success(function(e){var n=angular.toJson(e.res.record);t.set("user",n)})}var s={getUser:n,getToken:o,isLoggedIn:r,refreshUser:a};return s}e.$inject=["$http","appStorage"],angular.module("opinionated.utilities").factory("appAuth",e)}(),function(){"use strict";angular.module("opinionated.landing",[])}(),function(){"use strict";function e(e,t,n,o,r,a,s,i){function l(e){e=e||{};var t=i.home.get({page:v.homePage,timestamp:v.lastUpdated,filter:v.homeFilter},function(){v.homeFilter&&(v.threads=[]),e.append?v.threads=v.threads.concat(t.res.records):v.threads=t.res.records.concat(v.threads),v.noMoreThreads=!t.res.morePages,v.lastUpdated=Date.now()})}function c(){"created"==v.rowFilter?v.rowFilter="-created":v.rowFilter="created"}function d(){"-score"==v.rowFilter?v.rowFilter="score":v.rowFilter="-score"}function m(){"-saves.length"==v.rowFilter?v.rowFilter="saves.length":v.rowFilter="-saves.length"}function u(){"-comments.length"==v.rowFilter?v.rowFilter="comments.length":v.rowFilter="-comments.length"}function p(e){var t=i.single.get({threadId:e._id},function(){t.$downvote({threadId:e._id},function(){angular.extend(e,t.res.record)})})}function f(e){var t=i.single.get({threadId:e._id},function(){t.$upvote({threadId:e._id},function(){angular.extend(e,t.res.record)})})}function g(e){var t=i.single.get({threadId:e._id},function(){t.$doSave({threadId:e._id},function(){angular.extend(e,t.res.record)})})}function h(e){var t=i.single.get({threadId:e._id},function(){t.$doUnsave({threadId:e._id},function(){angular.extend(e,t.res.record)})})}var v=this;v.threads=[],v.getHomeThreads=l,v.homePage=0,v.lastUpdated=0,v.homeFilter="",v.orderByDate=c,v.orderByScore=d,v.orderBySaves=m,v.orderByComments=u,v.upvote=f,v.downvote=p,v.save=g,v.unsave=h;var $;t.$watch("vm.homeFilter",function(e,t){!e!==t&&(v.threads=[]),o.cancel($),$=o(function(){e?v.getHomeThreads():v.homeFilterEnabled&&(v.lastUpdated=0,v.getHomeThreads()),v.homeFilterEnabled=""!==v.homeFilter},500)}),l()}e.$inject=["$state","$scope","$rootScope","$timeout","appAuth","appUsers","appStreams","appThreads"],angular.module("opinionated.landing").controller("HomeController",e)}(),function(){"use strict";function e(e,t,n,o,r){function a(){var e=n.list.get({},function(){i.streamList=e.res.records})}function s(e){if(e){var n=new o.single({title:i.thread.title,content:i.thread.content,stream:i.thread.stream});n.$save(function(e){e.success?(t.url("streams/"+i.thread.stream+"/"+e.res.record._id),r.success("You just posted a thread called: "+e.res.record.title)):r.error(e.res.message)})}else r.error("Seems like something is missing")}var i=this;i.streamList=[],i.getStreams=a,i.create=s,i.thread={title:"",content:"",stream:""},a()}e.$inject=["$state","$location","appStreams","appThreads","appToast"],angular.module("opinionated.landing").controller("LandingPostController",e)}(),function(){"use strict";angular.module("opinionated.authentication",[])}(),function(){"use strict";function e(e,t,n,o,r,a,s){function i(){d.signupForm.$setUntouched(),d.signupForm.$setPristine(),d.user.name=d.user.username=d.user.email=d.user.password=d.user.confirm=""}function l(e){if(e){var t=new a.single({name:d.user.name,username:d.user.username,email:d.user.email,password:d.user.password});t.$save(function(e){e.success?(i(),c(e.res.record,e.res.token)):s.error(reponse.res.message)})}else s.error("Hmm, something seems to be missing...")}function c(e,t){var a=angular.toJson(e);r.set("user",a),r.set("opinion-token",t),n.$broadcast("loggedIn"),s.success("Welcome to Opinionated, "+e.name+". Let's get started"),o.url(e._id+"/profileInfo")}var d=this;d.reset=i,d.create=l,d.user={name:"",username:"",email:"",password:""}}e.$inject=["$state","$scope","$rootScope","$location","appStorage","appUsers","appToast"],angular.module("opinionated.authentication").controller("SignupController",e)}(),function(){"use strict";function e(e,t,n,o,r,a,s,i){function l(){var e=a.single.get({userId:m},function(){e.gender=d.profile.gender,e.occupation=d.profile.occupation,e.phone=d.profile.phone,e.birthday=d.profile.birthday,e.interests=d.profile.interests,e.bio=d.profile.bio,e.$updateProfile({userId:m},function(e){e.success?(s.success("You're getting off to a great start, "+d.user.name),o.url("profile/"+m+"/overview")):s.error(reponse.res.message)})})}function c(e){e&&i.upload({url:"/users/uploadPicture/"+m,file:e}).progress(function(e){d.progressPercentage=parseInt(100*e.loaded/e.total)}).success(function(e,t,n,o){s.success("Your photo has been uploaded!"),d.uploaded=!0})}var d=this,m=t.userId;d.user=r.getUser(),d.submit=l,d.uploadImage=c,d.uploaded="",d.profile={gender:"",occupation:"",phone:"",birthday:"",interests:"",bio:""},n.$watch(function(){return n.file},function(){d.uploadImage(n.file)})}e.$inject=["$state","$stateParams","$scope","$location","appAuth","appUsers","appToast","Upload"],angular.module("opinionated.authentication").controller("ProfileInfoController",e)}(),function(){"use strict";function e(e,t,n){n.remove("user"),n.remove("opinion-token"),e.$broadcast("loggedOut"),t.go("landing.home")}e.$inject=["$rootScope","$state","appStorage"],angular.module("opinionated.authentication").controller("LogoutController",e)}(),function(){"use strict";function e(e,t,n,o,r,a){function s(){c.loginForm.$setUntouched(),c.loginForm.$setPristine(),c.user.email=c.user.password=""}function i(e){if(e){var t=new r.auth({email:c.user.email,password:c.user.password});t.$save(function(e){e.success?(s(),l(e.res.record,e.res.token)):a.error(e.res.message)})}else a.error("Hmm, seems like something is missing")}function l(e,r){var s=angular.toJson(e);o.set("user",s),o.set("opinion-token",r),t.$broadcast("loggedIn"),a.success("Welcome back, "+e.name),n.url("profile/"+e._id+"/overview")}var c=this;c.reset=s,c.login=i,c.postLogin=l,c.user={email:"",password:""}}e.$inject=["$scope","$rootScope","$location","appStorage","appUsers","appToast"],angular.module("opinionated.authentication").controller("LoginController",e)}(),function(){"use strict";function e(e,t,n,o,r,a,s,i,l,c){function d(){s.isLoggedIn()?y.currentUserId=s.getUser()._id:y.currentUserId=""}function m(){var e=i.single.get({threadId:j},function(){y.threads=[e.res.record],y.isMod=e.res.isMod})}function u(e){var t=i.single.get({threadId:e._id},function(){t.$upvote({threadId:e._id},function(){angular.extend(e,t.res.record)})})}function p(e){var t=i.single.get({threadId:e._id},function(){t.$downvote({threadId:e._id},function(){angular.extend(e,t.res.record)})})}function f(e){var t=i.single.get({threadId:e._id},function(){t.$doSave({threadId:e._id},function(){angular.extend(e,t.res.record)})})}function g(e){var t=i.single.get({threadId:e._id},function(){t.$doUnsave({threadId:e._id},function(){angular.extend(e,t.res.record)})})}function h(e){e=e||{};var t=l.list.get({threadId:j,page:y.commentPage,filter:y.commentsFilter,timestamp:y.lastUpdated},function(){y.commentsFilter&&(y.comments=[]),e.append?y.comments=y.comments.concat(t.res.records):y.comments=t.res.records.concat(y.comments),y.noMoreComments=!t.res.morePages,y.lastUpdated=Date.now()})}function v(){y.commentPage++,y.lastUpdated=0,y.getComments({append:!0})}function $(){o.show({controller:["$scope","$mdDialog",function(e,t){e.close=function(){t.hide(),c.success("Phew, that was a close one"),y.showMod=!y.showMod},e.getThread=function(){i.single.get({threadId:j}).$promise.then(function(t){t.res.thread=t.res.record,angular.extend(e,t.res)})},e.confirm=function(){var e=i.single.get({threadId:j},function(){e.$destroy({threadId:j},function(e){e.success?(t.hide(),r.url("streams/"+_),c.error("You have just deleted your thread")):c.error(e.res.message)})})},e.getThread()}],templateUrl:"/app/admin/threads/dialogs/delete.thread.dialog.tmpl.html"})["finally"](function(){})}function I(e){o.show({controller:["$scope","$mdDialog",function(n,o){n.close=function(){o.hide(),c.success("Phew, that was a close one")},n.getComment=function(){l.single.get({commentId:e._id}).$promise.then(function(e){e.res.comment=e.res.record,angular.extend(n,e.res)})},n.confirm=function(n){var n=l.single.get({commentId:e._id},function(){n.$destroy({commentId:e._id},function(e){e.success?(o.hide(),t.reload(),c.error("You have deleted your comment")):c.error(e.res.message)})})},n.getComment()}],templateUrl:"/app/admin/comments/dialogs/delete.comment.dialog.tmpl.html"})["finally"](function(){y.getComment()})}function w(){o.show({controller:["$scope","$mdDialog",function(e,t){e.reset=function(){e.addCommentForm.$setUntouched(),e.addCommentForm.$setPristine(),e.content=""},e.create=function(e){if(e){var n=new l.single({content:this.content,thread:j});n.$save(function(e){e.success?(c.success("You just commented on this thread!"),y.getComments(),t.hide()):c.error(e.res.message)})}else c.error("Hmm... looks like something is missing")},e.close=function(){t.hide()}}],templateUrl:"/app/admin/threads/dialogs/create.comment.dialog.tmpl.html"})["finally"](function(){y.getComments({reload:!0})})}function F(e){var t=l.single.get({commentId:e._id},function(){t.$upvote({commentId:e._id},function(){angular.extend(e,t.res.record)})})}function U(e){var t=l.single.get({commentId:e._id},function(){t.$downvote({commentId:e._id},function(){angular.extend(e,t.res.record)})})}function P(e){var t=l.single.get({commentId:e._id},function(){t.$doSave({commentId:e._id},function(){angular.extend(e,t.res.record)})})}function S(e){var t=l.single.get({commentId:e._id},function(){t.$doUnsave({commentId:e._id},function(){angular.extend(e,t.res.record)})})}function C(){"created"==y.rowFilter?y.rowFilter="-created":y.rowFilter="created"}function T(){"-score"==y.rowFilter?y.rowFilter="score":y.rowFilter="-score"}function b(){"-saves.length"==y.rowFilter?y.rowFilter="saves.length":y.rowFilter="-saves.length"}var y=this,_=n.streamId,j=n.threadId;y.getCurrentUser=d(),y.currentUserId="",y.threads=[],y.comments=[],y.getThread=m,y.openDeleteThread=$,y.upvote=u,y.downvote=p,y.save=f,y.unsave=g,y.getComments=h,y.loadMore=v,y.openAddComment=w,y.openDeleteComment=I,y.commentUpvote=F,y.commentDownvote=U,y.commentSave=P,y.commentUnsave=S,y.commentPage=0,y.lastUpdated=0,y.commentsFilter="",y.orderByDate=C,y.orderByScore=T,y.orderBySaves=b;var M;e.$watch("vm.commentsFilter",function(e,t){!e!==t&&(y.comments=[]),a.cancel(M),M=a(function(){e?y.getComments():y.commentsFilterEnabled&&(y.lastUpdated=0,y.getComments()),y.commentsFilterEnabled=""!==y.commentsFilter},500)}),d(),m(),h()}e.$inject=["$scope","$state","$stateParams","$mdDialog","$location","$timeout","appAuth","appThreads","appComments","appToast"],angular.module("opinionated.admin").controller("ThreadController",e)}(),function(){"use strict";function e(e){e.state("streams",{templateUrl:"/app/admin/streams/streams.tmpl.html","abstract":!0}),e.state("streams.create",{url:"/streams/create-stream",templateUrl:"/app/admin/streams/create/streams.create.tmpl.html",controller:"StreamsCreateController",controllerAs:"vm"}),e.state("streams.list",{url:"/streams/list",templateUrl:"/app/admin/streams/list/streams.list.tmpl.html",controller:"StreamsListController",controllerAs:"vm"}),e.state("streams.single",{url:"/streams/:streamId",templateUrl:"/app/admin/streams/single/streams.single.tmpl.html",controller:"StreamsSingleController",controllerAs:"vm"}),e.state("streams.edit",{url:"/streams/:streamId/edit",templateUrl:"/app/admin/streams/edit/streams.edit.tmpl.html",controller:"StreamsEditController",controllerAs:"vm"}),e.state("streams.thread",{url:"/streams/:streamId/:threadId",templateUrl:"/app/admin/threads/thread.tmpl.html",controller:"ThreadController",controllerAs:"vm"}),e.state("streams.threadEdit",{url:"/streams/thread/:threadId/edit",templateUrl:"/app/admin/threads/edit/thread.edit.tmpl.html",controller:"ThreadEditController",controllerAs:"vm"}),e.state("streams.commentEdit",{url:"/streams/:threadId/:commentId/edit",templateUrl:"/app/admin/comments/edit/edit.comment.tmpl.html",controller:"EditCommentController",controllerAs:"vm"})}e.$inject=["$stateProvider"],angular.module("opinionated.admin").config(e)}(),function(){"use strict";function e(e,t,n,o,r,a,s,i,l,c,d){function m(){var e=l.single.get({userId:v},function(){h.profile=[e.res.record],h.alreadyFollowing=e.res.alreadyFollowing})}function u(){var e=l.single.get({userId:v},function(){e.$follow({userId:v},function(){a(function(){h.getProfile({reload:!0})},200)})})}function p(){var e=l.single.get({userId:v},function(){e.$unfollow({userId:v},function(e){a(function(){h.getProfile({reload:!0})},200)})})}function f(e){e&&c.upload({url:"/users/uploadPicture/"+v,file:e}).progress(function(e){h.progressPercentage=parseInt(100*e.loaded/e.total)}).success(function(e,n,o,r){t.$broadcast("userImageUpload")}).then(function(){h.getProfile({reload:!0})})}function g(){s.show({controller:["$scope","$mdDialog",function(e,t){e.reset=function(){e.updateProfileForm.$setUntouched(),e.updateProfileForm.$setPristine(),e.gender=e.occupation=e.phone=e.birthday=e.interests=e.bio=""},e.close=function(){t.hide()},e.update=function(){var n=l.single.get({userId:v},function(){n.gender=e.gender,n.occupation=e.occupation,n.phone=e.phone,n.birthday=e.birthday,n.interests=e.interests,n.bio=e.bio,n.$updateProfile({userId:v},function(n){n.success?(e.reset(),h.getProfile({reload:!0}),t.hide(),d.success("You have successfully updated your profile"+n.res.record.name)):d.error(n.res.message)})})}}],templateUrl:"/app/admin/profile/dialogs/update.profile.dialog.tmpl.html"})["finally"](function(){h.getProfile({reload:!0})})}var h=this,v=o.userId;h.stateName=n.current.name,h.selfProfile=v===i.getUser()._id,h.profile=[],h.getProfile=m,h.follow=u,h.unfollow=p,h.uploadImage=f,h.openUpdateProfile=g,e.$watch(function(){return e.file},function(){h.uploadImage(e.file)}),m()}e.$inject=["$scope","$rootScope","$state","$stateParams","$location","$timeout","$mdDialog","appAuth","appUsers","Upload","appToast"],angular.module("opinionated.admin").controller("ProfileController",e)}(),function(){"use strict";function e(e){e.state("profile",{url:"/profile/:userId","abstract":!0,templateUrl:"/app/admin/profile/profile.tmpl.html",controller:"ProfileController",controllerAs:"vm"}),e.state("profile.overview",{url:"/overview",templateUrl:"/app/admin/profile/overview/overview.tmpl.html",controller:"ProfileOverviewController",controllerAs:"vm"}),e.state("profile.threads",{url:"/threads",templateUrl:"/app/admin/profile/threads/threads.tmpl.html",
controller:"ProfileThreadsController",controllerAs:"vm"}),e.state("profile.comments",{url:"/comments",templateUrl:"/app/admin/profile/comments/comments.tmpl.html",controller:"ProfileCommentsController",controllerAs:"vm"}),e.state("profile.saved",{url:"/saved",templateUrl:"/app/admin/profile/saved/saved.tmpl.html",controller:"ProfileSavedController",controllerAs:"vm"})}e.$inject=["$stateProvider"],angular.module("opinionated.admin").config(e)}(),function(){"use strict";function e(e){return{single:e("users/:userId/:action",{userId:"@_id"},{follow:{method:"POST",params:{action:"follow"}},unfollow:{method:"POST",params:{action:"unfollow"}},updateProfile:{method:"POST",params:{action:"updateProfile"}}}),auth:e("users/authenticate")}}function t(e){var t=e("users/search/:keyword",{},{query:{isArray:!1}});return function(e,n){var o={keyword:e};n&&(o.onlyUsernames=!0);var r=t.query(o).$promise;return r}}e.$inject=["$resource"],t.$inject=["$resource"],angular.module("opinionated.admin").factory("appUsers",e).factory("appUsersSearch",t)}(),function(){"use strict";function e(e){return{single:e("threads/:threadId/:action",{threadId:"@_id"},{upvote:{method:"POST",params:{action:"upvote"}},downvote:{method:"POST",params:{action:"downvote"}},doSave:{method:"POST",params:{action:"save"}},doUnsave:{method:"POST",params:{action:"unsave"}},modify:{method:"POST",params:{action:"modify"}},destroy:{method:"DELETE",params:{action:"remove"}}}),list:e("threads/stream/:streamId"),timeline:e("threads/timeline/:userId"),saved:e("threads/saved/:userId"),home:e("threads/home")}}e.$inject=["$resource"],angular.module("opinionated.admin").factory("appThreads",e)}(),function(){"use strict";function e(e){return{single:e("streams/:streamId/:action",{streamId:"@_id"},{subscribe:{method:"POST",params:{action:"subscribe"}},unsubscribe:{method:"POST",params:{action:"unsubscribe"}},modify:{method:"POST",params:{action:"modify"}},destroy:{method:"DELETE",params:{action:"remove"}}}),list:e("streams/list")}}e.$inject=["$resource"],angular.module("opinionated.admin").factory("appStreams",e)}(),function(){"use strict";function e(e){return{single:e("comments/:commentId/:action",{commentId:"@_id"},{upvote:{method:"POST",params:{action:"upvote"}},downvote:{method:"POST",params:{action:"downvote"}},doSave:{method:"POST",params:{action:"save"}},doUnsave:{method:"POST",params:{action:"unsave"}},modify:{method:"POST",params:{action:"modify"}},destroy:{method:"DELETE",params:{action:"remove"}}}),list:e("comments/thread/:threadId"),timeline:e("comments/timeline/:userId"),saved:e("comments/saved/:userId")}}e.$inject=["$resource"],angular.module("opinionated.admin").factory("appComments",e)}(),function(){"use strict";function e(e){return{single:e("chats/:chatId/:action",{chatId:"@_id"},{message:{method:"POST",params:{action:"message"}}})}}e.$inject=["$resource"],angular.module("opinionated.admin").factory("appChats",e)}(),function(){"use strict";function e(e){e.state("chats",{templateUrl:"/app/admin/chats/chats.tmpl.html","abstract":!0}),e.state("chats.inbox",{url:"/inbox",templateUrl:"/app/admin/chats/inbox/chats.inbox.tmpl.html",controller:"ChatsInboxController",controllerAs:"vm"}),e.state("chats.inbox.single",{url:"/:chatId",templateUrl:"/app/admin/chats/dialogs/chats.single.tmpl.html",controller:"ChatsSingleController",controllerAs:"vm"})}e.$inject=["$stateProvider"],angular.module("opinionated.admin").config(e)}(),function(){"use strict";function e(e){e.state("landing",{templateUrl:"/app/landing/landing.tmpl.html","abstract":!0}),e.state("landing.home",{url:"/home",templateUrl:"/app/landing/home/home.tmpl.html",controller:"HomeController",controllerAs:"vm"}),e.state("landing.create",{url:"/create-post",templateUrl:"/app/landing/create-post/create.tmpl.html",controller:"LandingPostController",controllerAs:"vm"})}e.$inject=["$stateProvider"],angular.module("opinionated.landing").config(e)}(),function(){"use strict";function e(e){e.state("authentication",{templateUrl:"/app/authentication/authentication.tmpl.html","abstract":!0}),e.state("authentication.signup",{url:"/signup",templateUrl:"/app/authentication/signup/signup.tmpl.html",controller:"SignupController",controllerAs:"vm"}),e.state("authentication.login",{url:"/login",templateUrl:"/app/authentication/login/login.tmpl.html",controller:"LoginController",controllerAs:"vm"}),e.state("authentication.profileInfo",{url:"/:userId/profileInfo",templateUrl:"/app/authentication/profileInfo/profile.info.tmpl.html",controller:"ProfileInfoController",controllerAs:"vm"}),e.state("authentication.logout",{url:"/logout",templateUrl:"/app/landing/home/home.tmpl.html",controller:"LogoutController"})}e.$inject=["$stateProvider"],angular.module("opinionated.authentication").config(e)}(),function(){"use strict";angular.module("opinionated",["ui.router","ngResource","ngMaterial","opinionated.utilities","opinionated.admin","opinionated.authentication","opinionated.landing","opinionated.moment"])}(),function(){"use strict";function e(e,t,n,o,r,a,s,i){function l(){r("left").toggle()}function c(){m.isLoggedIn=s.isLoggedIn(),m.user=s.getUser()}function d(){if(m.isLoggedIn)var e=i.list.get({subscribed:!0},function(){m.homeStreams=e.res.records});else var e=i.list.get({},function(){m.homeStreams=e.res.records})}var m=this;m.openUserMenu=l,m.updateLoginStatus=c,m.getHomeStreams=d,m.homeStreams=[],t.$on("loggedIn",function(){c()}),t.$on("loggedOut",function(){c()}),t.$on("$stateChangeSuccess",function(){r("left").close(),m.showStreams&&(m.showStreams=!m.showStreams)}),c(),d()}e.$inject=["$scope","$rootScope","$location","$mdDialog","$mdSidenav","appUsersSearch","appAuth","appStreams"],angular.module("opinionated").controller("AppController",e)}(),function(){"use strict";function e(e,t,n){t.when("","/home"),t.when("/","/home"),n.interceptors.push("tokenHttpInterceptor")}e.$inject=["$stateProvider","$urlRouterProvider","$httpProvider"],angular.module("opinionated").config(e)}();